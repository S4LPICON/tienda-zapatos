{% extends 'apis/base.html' %}

{% block content %}
<div class="stats">
    <div class="stat-card">
        <h3>{{ total_productos }}</h3>
        <p>Productos Totales</p>
    </div>
    <div class="stat-card">
        <h3>{{ productos_activos }}</h3>
        <p>Productos Activos</p>
    </div>
    <div class="stat-card">
        <h3>{{ total_consultas }}</h3>
        <p>Consultas API</p>
    </div>
</div>

<div class="card">
    <h2>ğŸš€ Bienvenido al Sistema de IntegraciÃ³n de APIs - Tienda de Zapatos</h2>
    <p style="margin-bottom: 1.5rem; color: #666; line-height: 1.6;">
        Sistema especializado en gestiÃ³n de catÃ¡logo de calzado y zapatos, integrando dos APIs pÃºblicas siguiendo el patrÃ³n MVC:
    </p>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 2rem;">
        <div style="border: 2px solid #667eea; border-radius: 12px; padding: 1.5rem;">
            <h3 style="color: #667eea; margin-bottom: 1rem;">ğŸ‘Ÿ API 1: DummyJSON (Calzado)</h3>
            <p style="color: #666; margin-bottom: 1rem;">Obtiene catÃ¡logo de zapatos y calzado con informaciÃ³n detallada.</p>
            <ul style="color: #666; margin-left: 1.5rem; line-height: 1.8;">
                <li>SincronizaciÃ³n de zapatos</li>
                <li>BÃºsqueda especializada en calzado</li>
                <li>Almacenamiento en PostgreSQL</li>
                <li>Historial en MongoDB</li>
            </ul>
        </div>
        
        <div style="border: 2px solid #764ba2; border-radius: 12px; padding: 1.5rem;">
            <h3 style="color: #764ba2; margin-bottom: 1rem;">ğŸ’± API 2: ExchangeRate</h3>
            <p style="color: #666; margin-bottom: 1rem;">Convierte precios de USD a COP en tiempo real.</p>
            <ul style="color: #666; margin-left: 1.5rem; line-height: 1.8;">
                <li>Tasas de cambio actualizadas</li>
                <li>ConversiÃ³n automÃ¡tica</li>
                <li>Historial de conversiones</li>
                <li>Almacenamiento en MongoDB</li>
            </ul>
        </div>
    </div>
    
    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{% url 'apis:lista_productos' %}" class="btn btn-primary">ğŸ‘Ÿ Ver Zapatos</a>
        <form method="post" action="{% url 'apis:sincronizar_productos' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn btn-success">ğŸ”„ Sincronizar Zapatos</button>
        </form>
        <a href="{% url 'apis:buscar' %}" class="btn btn-warning">ğŸ” Buscar Calzado</a>
        <a href="{% url 'apis:historial' %}" class="btn btn-primary">ğŸ“œ Ver Historial MongoDB</a>
    </div>
</div>

<div class="card">
    <h2>ğŸ“Š Ãšltimas Consultas</h2>
    {% if ultimas_consultas %}
    <table>
        <thead>
            <tr>
                <th>API</th>
                <th>Tipo</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Detalles</th>
            </tr>
        </thead>
        <tbody>
            {% for consulta in ultimas_consultas %}
            <tr>
                <td><strong>{{ consulta.api_nombre }}</strong></td>
                <td>{{ consulta.get_tipo_display }}</td>
                <td>{{ consulta.fecha_consulta|date:"d/m/Y H:i" }}</td>
                <td>
                    {% if consulta.exitosa %}
                    <span style="color: #28a745;">âœ“ Exitosa</span>
                    {% else %}
                    <span style="color: #dc3545;">âœ— Error</span>
                    {% endif %}
                </td>
                <td style="max-width: 300px; overflow: hidden; text-overflow: ellipsis;">{{ consulta.detalles }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="color: #666; text-align: center; padding: 2rem;">No hay consultas registradas aÃºn.</p>
    {% endif %}
</div>

<div class="card">
    <h2>ğŸ”§ Arquitectura MVC</h2>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
            <h3 style="color: #667eea; margin-bottom: 0.5rem;">ğŸ“‹ Modelo</h3>
            <p style="color: #666; font-size: 0.9rem;">ProductoAPI, ConsultaAPI (PostgreSQL) + MongoDB para historial</p>
        </div>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
            <h3 style="color: #667eea; margin-bottom: 0.5rem;">ğŸ‘ï¸ Vista</h3>
            <p style="color: #666; font-size: 0.9rem;">Templates HTML con diseÃ±o responsivo</p>
        </div>
        <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px;">
            <h3 style="color: #667eea; margin-bottom: 0.5rem;">ğŸ® Controlador</h3>
            <p style="color: #666; font-size: 0.9rem;">views.py orquesta los servicios y modelos</p>
        </div>
    </div>
</div>
{% endblock %}
